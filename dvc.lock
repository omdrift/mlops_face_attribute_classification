schema: '2.0'
stages:
  prepare_train:
    cmd: python src/data/make_dataset.py
    deps:
    - path: data/annotations/mapped_train.csv
      hash: md5
      md5: 64c7d882c6af9a414d73d53b918a0fa6
      size: 483137
    - path: data/raw
      hash: md5
      md5: 90e1873184de659efc1794b2a0058212.dir
      size: 7337657880
      nfiles: 100006
    - path: src/data/make_dataset.py
      hash: md5
      md5: 0d5bf265e72dfdd227ea1fc98e64e6cd
      size: 4921
    outs:
    - path: data/processed/train_data_s1.pt
      hash: md5
      md5: 7ad1a90a1576d5dd099d80ad6e7254b1
      size: 1033643029
  hyperopt:
    cmd: python src/training/hyperopt_search.py --max-evals 10
    deps:
    - path: data/processed/train_data_s1.pt
      hash: md5
      md5: 7ad1a90a1576d5dd099d80ad6e7254b1
      size: 1033643029
    - path: src/models/architecture.py
      hash: md5
      md5: d20737d55975392a696975519aeba468
      size: 4593
    - path: src/training/hyperopt_search.py
      hash: md5
      md5: f8834bbb5e8a6cb0321542a5050ff19a
      size: 12766
    - path: src/training/loops.py
      hash: md5
      md5: 998eae951fbb313b799927bcffda83ee
      size: 6049
    params:
      params.yaml:
        hyperopt.max_evals: 20
    outs:
    - path: src/training/hyperopt_params.json
      hash: md5
      md5: 393204b8aeb699b1147dbf62e786c7cb
      size: 210
  train:
    cmd: python src/training/train.py
    deps:
    - path: data/processed/train_data_s1.pt
      hash: md5
      md5: 7ad1a90a1576d5dd099d80ad6e7254b1
      size: 1033643029
    - path: src/models/architecture.py
      hash: md5
      md5: d20737d55975392a696975519aeba468
      size: 4593
    - path: src/training/hyperopt_params.json
      hash: md5
      md5: 393204b8aeb699b1147dbf62e786c7cb
      size: 210
    - path: src/training/loops.py
      hash: md5
      md5: 998eae951fbb313b799927bcffda83ee
      size: 6049
    - path: src/training/train.py
      hash: md5
      md5: 4e815e343dae5eb5d392043cdc3c892b
      size: 14822
    params:
      params.yaml:
        train.batch_size: 32
        train.epochs: 10
    outs:
    - path: metrics/train_metrics.json
      hash: md5
      md5: f8f95673be4f0b60e64a8ffc9912cb79
      size: 385
    - path: models/best_model.pth
      hash: md5
      md5: 2126d7b1d7c844ba9ff3d548f805f872
      size: 62893220
  evaluate:
    cmd: python src/training/evaluate.py
    deps:
    - path: data/processed/train_data_s1.pt
      hash: md5
      md5: 7ad1a90a1576d5dd099d80ad6e7254b1
      size: 1033643029
    - path: models/best_model.pth
      hash: md5
      md5: 2126d7b1d7c844ba9ff3d548f805f872
      size: 62893220
    - path: src/training/evaluate.py
      hash: md5
      md5: cd626520a55c1cc53350420539f84564
      size: 5656
    params:
      params.yaml:
        evaluate.random_state: 42
        evaluate.test_size: 0.2
    outs:
    - path: metrics/eval_metrics.json
      hash: md5
      md5: a11f67f3faa1ac66fad6621c0152782d
      size: 1631
  inference_batches:
    cmd: python src/inference/batch_inference.py
    deps:
    - path: data/raw
      hash: md5
      md5: 90e1873184de659efc1794b2a0058212.dir
      size: 7337657880
      nfiles: 100006
    - path: models/best_model.pth
      hash: md5
      md5: 2126d7b1d7c844ba9ff3d548f805f872
      size: 62893220
    - path: src/inference/batch_inference.py
      hash: md5
      md5: 19257054761a709bca07f80ddd00d193
      size: 5796
    params:
      params.yaml:
        inference.batch_size: 64
        inference.output_path: outputs/predictions.csv
    outs:
    - path: outputs/predictions.csv
      hash: md5
      md5: 39f08fa6411e408e112a70aeddec3903
      size: 2300055
